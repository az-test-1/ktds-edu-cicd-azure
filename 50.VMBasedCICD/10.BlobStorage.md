# Blob Storage





# 1. 개요

Azure CLI를 사용하여 **Storage Account**, **Blob Storage Container**, 그리고 **Role Assignment**를 생성해보자.





# 2. **Storage Account 생성**



## 1) 환경변수



```sh

export ARM_CLIENT_ID="<Your-Service-Principal-Client-ID>"
export ARM_SUBSCRIPTION_ID="<Your-Subscription-ID>"
export ARM_TENANT_ID="<Your-Tenant-ID>"

export RESOURCE_GROUP_NAME="yjedu-rg"
export LOCATION="koreacentral"
export STORAGE_ACCOUNT_NAME="songvmarti"
export CONTAINER_NAME="song-vm-arti-con"

```





## 2) **Storage Account 생성**

```bash


# 1. 스토리지 계정 생성
az storage account create \
    --name $STORAGE_ACCOUNT_NAME \
    --resource-group $RESOURCE_GROUP_NAME \
    --location $LOCATION \
    --sku Standard_LRS \
    --kind StorageV2

# 2. Blob 컨테이너 생성
az storage container create \
    --name $CONTAINER_NAME \
    --account-name $STORAGE_ACCOUNT_NAME \
    --public-access blob \
    --auth-mode login

# 3. Role Assignment (권한 부여)
az role assignment create \
    --assignee $ARM_CLIENT_ID \
    --role "Storage Blob Data Owner" \
    --scope /subscriptions/$ARM_SUBSCRIPTION_ID/resourceGroups/$RESOURCE_GROUP_NAME/providers/Microsoft.Storage/storageAccounts/$STORAGE_ACCOUNT_NAME
    
```





# 3. upload



Service Principal 을 이용해서 권한 할당 및 login , upload 를 수행한다.



## 1) **권한 할당**

upload 수행을 위해서는 **Storage Blob Data Contributor** 또는 **Storage Blob Data Owner** 역할이 필요하다.

```sh


az role assignment create \
  --assignee $ARM_CLIENT_ID \
  --role "Storage Blob Data Contributor" \
  --scope /subscriptions/$ARM_SUBSCRIPTION_ID/resourceGroups/$RESOURCE_GROUP_NAME/providers/Microsoft.Storage/storageAccounts/$STORAGE_ACCOUNT_NAME
  

az login \
  --service-principal \
  --username $ARM_CLIENT_ID \
  --password $ARM_CLIENT_SECRET \
  --tenant $ARM_TENANT_ID
          

az account set --subscription $ARM_SUBSCRIPTION_ID

```





## 2) upload 수행



```sh

# format
az storage blob upload \
    --account-name $STORAGE_ACCOUNT_NAME \
    --container-name $CONTAINER_NAME \
    --name <blob_name> \
    --file <local_file_path> \
    --overwrite \
    --auth-mode login

# 실제수행
az storage blob upload \
    --account-name $STORAGE_ACCOUNT_NAME \
    --container-name $CONTAINER_NAME \
    --name text01.txt \
    --file ./text01.txt \
    --overwrite \
    --auth-mode login

```

