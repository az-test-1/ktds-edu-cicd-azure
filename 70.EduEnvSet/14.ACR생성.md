# 1. 개요

CI/CD에서 Image 저장을 위한 Azure Container Registry  생성





#  2. Azure ACR 생성

* Azure ACR 생성

```sh
RG_NAME=abclab-dev-rg
ACR_NAME=abclabacr
LOCATION=koreacentral
SUB_ID=bbe8692f-000e-471b-ba79-c5eec94ca3d0

$ az acr create \
  --resource-group ${RG_NAME} \
  --admin-enabled true \
  --name ${ACR_NAME} --sku Premium


```

* Azure ACR 생성 확인

```sh
$ az acr list -o table

NAME       RESOURCE GROUP    LOCATION      SKU      LOGIN SERVER          CREATION DATE         ADMIN ENABLED
---------  ----------------  ------------  -------  --------------------  --------------------  ---------------
abclabacr  abclab-dev-rg     koreacentral  Premium  abclabacr.azurecr.io  2024-09-11T00:51:44Z  False

```





# 3. ACR 확인



## 1) ACR Login



### (1) ACR 패스워드 확인

* abclabacr 인증정보(패스워드) 확인한다.

* docker login 시 필요하다.

```sh
$ az acr credential show -n abclabacr -o table 

USERNAME    PASSWORD                                              PASSWORD2
----------  ----------------------------------------------------  ----------------------------------------------------
abclabacr   DFLJ2m1BVKNNbV+m92Xpdc4FOL96rb7ba10GXujFST+ACRBWBjcm  M8ZwqPkInj/Vp3kHV4OH3zx7s0C3hhQKeb10RHl2FB+ACRATD9Xd              

# 패스워드 두개 중 하나를 선택하면 된다.
```



### (2) ACR Login

```sh
 
$ az acr login \
    --name abclabacr.azurecr.io \
    --username abclabacr \
    --password DFLJ2m1BVKNNbV+m92Xpdc4FOL96rb7ba10GXujFST+ACRBWBjcm

Login Succeeded


## logout...
$ az acr logout abclabacr.azurecr.io

```







## 2) ACR Image Pull/Push Test



### (1) Docker Login

```sh
$ docker login abclabacr.azurecr.io \
    --username abclabacr \
    --password DFLJ2m1BVKNNbV+m92Xpdc4FOL96rb7ba10GXujFST+ACRBWBjcm

Login Succeeded


## logout...
$ docker logout abclabacr.azurecr.io

```



### (2) Docker Pull/Push

```sh
ACR_NAME=abclabacr


# Test용 Image Pull
$ docker pull mcr.microsoft.com/hello-world # docker 설치 필요

# ACR에 Push 하기 위한 tag 변경
$ docker tag mcr.microsoft.com/hello-world ${ACR_NAME}.azurecr.io/hello-world:v1

# ACR에 Image Upload
$ docker push ${ACR_NAME}.azurecr.io/hello-world:v제

# ACR에 Upload된 이미지 확인
$ az acr repository list --name  ${ACR_NAME} --output table

# ACR에 Upload된 이미지 삭제
$ az acr repository delete -n ${ACR_NAME} --repository hello-world -y

```





# 4. AKS ACR Attach

AKS 에서 ACR 의 container image 를 pull/push 하려면 해당 권한이 있어야 한다. 

권한부여를 위해 AKS 에서 ACR을 attach 하는 작업이 필요하다.



* 메뉴 : AKS 선택 > Container registries > Attach
  * acr 선택(abclabacr) 후 attach 한다.