

# github 환경 설정



# 1. 개요

**GitHub Actions**을 사용전 사전 환경을 설정한다.  GitHub CLI 설치**, **샘플 소스 클론**, **변수 및 시크릿 설정하는 방법을 설명한다.





# 2. **GitHub CLI 설치**

GitHub CLI(`gh`)를 Ubuntu에 설치하는 방법입니다. `gh`는 GitHub의 명령줄 도구로, 리포지토리 관리, PR 생성, 워크플로우 트리거 등의 작업을 쉽게 처리할 수 있다.



### 설치 방법:

1. **패키지 목록 업데이트**:

   ```bash
   sudo apt update
   ```

2. **GitHub CLI 패키지 리포지토리 추가**:

   ```bash
   type -p curl >/dev/null || sudo apt install curl -y
   curl -fsSL https://cli.github.com/packages/githubcli-archive-keyring.gpg | sudo dd of=/usr/share/keyrings/githubcli-archive-keyring.gpg
   sudo chmod go+r /usr/share/keyrings/githubcli-archive-keyring.gpg
   echo "deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/githubcli-archive-keyring.gpg] https://cli.github.com/packages stable main" | sudo tee /etc/apt/sources.list.d/github-cli.list > /dev/null
   ```

3. **GitHub CLI 설치**:

   ```bash
   sudo apt update
   sudo apt install gh
   ```

4. **설치 확인**:

   ```bash
   gh --version
   ```







# 3. **GitHub CLI 로그인 (gh login)**

먼저 GitHub CLI를 사용하려면 로그인 절차를 거쳐야 한다.

```bash
$ gh auth login

```

1. 로그인 방식
   - 어떤 **GitHub 계정**으로 로그인할 것인지.
   - **GitHub.com** 또는 **GitHub Enterprise** 중 선택.
   - **SSH** 또는 **HTTPS** 연결을 설정할지 선택.

2. 인증 방법을 선택하면, **GitHub Personal Access Token (PAT)** 또는 **웹 브라우저를 통해 로그인**할 수 있다.
   - 웹 브라우저 로그인을 선택하면 GitHub에서 로그인 절차를 완료하고 터미널로 돌아온다.

```sh
# 확인
$ gh repo list

```



# 4. **Sample Source Fork**

샘플 소스를 가져오기 위해서 포크(fork) 방식을 사용한다. 포크는 원본 리포지토리를 자신의 계정으로 복사하는 것을 의미한다. 이를 통해 독립적인 리포지토리에서 작업을 진행할 수 있다.

#### GitHub CLI로 포크

```bash
gh repo fork <원본 리포지토리 URL> --clone
```

예시:

```bash
gh repo fork https://github.com/username/repository --clone
```

clone 옵션은 원본 리포지토리를 포크하고, 로컬 머신에 복사한다.





# 5. **Variables/Secrets 설정**

이제 포크한 리포지토리에 필요한 **Variables**와 **Secrets**를 설정한다. 

일괄등록을 위해 `.ghvars` 파일과 `.ghsecrets` 파일을 각각 준비한다.



## 1) variable 생성

### **.ghvars 파일 생성**

```sh
$ cat > .ghvars
```

```bash
APP_NAME=my-app
AZURE_COMMON_RESOURCE_GROUP=my-resource-group
AZURE_COMMON_STORAGE_ACCOUNT=mystorageaccount
AZURE_COMMON_ARTIFACT_CONTAINER=artifact-container
AZURE_VM_PREFIX=vm-prefix
AZURE_VM_USER=azureuser
```



### **Variables 등록**

```bash
# Variables 등록
gh variable set -f .ghvars

```

이 명령은 `.ghvars`와 `.ghsecrets` 파일에 있는 정보를 각각 GitHub Variables 및 Secrets로 일괄 등록한다.



## 2) secret 생성

### **.ghsecrets 파일 생성**

```sh
$ cat > .ghsecrets
```

```bash
AZURE_VM_IP_DEV=123.456.789.101
GH_ADMIN_TOKEN=ghp_xxxxxxxx
AZURE_CREDENTIALS_COMMON='{
  "clientId": "your-common-client-id",
  "tenantId": "your-tenant-id",
  "clientSecret": "your-common-client-secret",
  "subscriptionId": "your-subscription-id"
}'
AZURE_CREDENTIALS_DEV='{
  "clientId": "your-dev-client-id",
  "tenantId": "your-tenant-id",
  "clientSecret": "your-dev-client-secret",
  "subscriptionId": "your-subscription-id"
}'
AZURE_VM_SSH_PRIVATE_KEY_DEV=your-ssh-private-key
AZURE_COMMON_STORAGE_ACCESS_KEY=your-storage-access-key
```



### **Secrets 등록**

```bash
# Secrets 등록
gh secret set -f .ghsecrets
```





## [참고] 개별등록

### 설정 예시

```bash
gh secret set AZURE_VM_IP_DEV --body "<DEV 환경 VM IP>"
gh secret set GH_ADMIN_TOKEN --body "<유저 PAT>"
gh secret set AZURE_CREDENTIALS_COMMON --body '{
  "clientId": "<제공받은 Common 서비스 주체 ID>",
  "tenantId": "<제공받은 Tenant ID>",
  "clientSecret": "<제공받은 Common 서비스 주체 Password>",
  "subscriptionId": "<제공받은 구독 ID>"
}'

gh secret set AZURE_CREDENTIALS_DEV --body '{
  "clientId": "<제공받은 DEV 서비스 주체 ID>",
  "tenantId": "<제공받은 Tenant ID>",
  "clientSecret": "<제공받은 DEV 서비스 주체 Password>",
  "subscriptionId": "<제공받은 구독 ID>"
}'

gh secret set AZURE_VM_SSH_PRIVATE_KEY_DEV --body "<제공받은 VM 접속용 SSH Key>"
gh secret set AZURE_COMMON_STORAGE_ACCESS_KEY --body "<제공받은 스토리지 계정 액세스 key>"
```



```bash
gh variable set APP_NAME --body "<애플리케이션 이름>"
gh variable set AZURE_COMMON_RESOURCE_GROUP --body "<사용할 리소스 그룹>"
gh variable set AZURE_COMMON_STORAGE_ACCOUNT --body "<사용할 스토리지 계정>"
gh variable set AZURE_COMMON_ARTIFACT_CONTAINER --body "<아티펙트 저장할 컨테이너 이름>"
gh variable set AZURE_VM_PREFIX --body "<VM 접두사>"
gh variable set AZURE_VM_USER --body "<VM 접속할 유저>"
```











